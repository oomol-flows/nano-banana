title: URL Images Nano Banana Edit
description: "A comprehensive subflow that orchestrates AI-powered image editing
  using the Nano Banana model. This workflow accepts image URLs and text
  prompts, processes them through an LLM to refine the editing instructions,
  submits the request to the Nano Banana API, and retrieves the final edited
  images. The subflow integrates prompt enhancement via LLM, asynchronous job
  submission, and result polling into a single reusable component suitable for
  batch image processing tasks."
nodes:
  - node_id: nano-banana-edit#1
    task: self::nano-banana-edit
    inputs_from:
      - handle: image_urls
        value:
          - "https://canvas-conversion-demo-dev.oss-cn-hangzhou.aliyuncs.com/%E\
            5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_2025-11-11_162033_040.jpg"
        from_flow:
          []
        from_node:
          - node_id: llm-json#2
            output_handle: image_urls
      - handle: prompt
        from_flow:
          []
        from_node:
          - node_id: llm-json#2
            output_handle: prompt

  - node_id: extract-request-id#1
    task: self::extract-request-id
    inputs_from:
      - handle: response
        from_node:
          - node_id: nano-banana-edit#1
            output_handle: result

  - node_id: nano-banana-get-result#1
    task: self::nano-banana-get-result
    inputs_from:
      - handle: request_id
        from_node:
          - node_id: extract-request-id#1
            output_handle: request_id
      - handle: poll_interval
        value:
        from_flow:
          - input_handle: poll_interval
      - handle: max_attempts
        value:
        from_flow:
          - input_handle: max_attempts
  - node_id: llm-json#2
    title: "大语言模型输出 JSON #2"
    inputs_from:
      - handle: messages
        value: null
      - handle: timeout
        value: 30
      - handle: retry_times
        value: 0
      - handle: retry_sleep
        value: 3.5
      - handle: model
        value:
          model: deepseek-chat
          temperature: 0.5
          top_p: 1
          max_tokens: 128000
      - handle: template
        value:
          - role: user
            content: "- You are an expert in AI image editing. Your job is to refine user
              intent into clear, precise AI image processing instructions that
              accurately reflect the user's goals. \ 

              - Key elements:

              \  1. {{main_picture}} - main image (first in array)

              \  2. {{reference_picture}} - reference image
              (second in array)

              \  3. {{prompt}} - User’s business needs

              - Processing requirements:

              \  - When users refer to \"main image\" they are
              referring to {{main_picture}}

              \  - When users refer to \"reference images\" they
              are referring to {{reference_picture}}

              \  - All other descriptions specify the processing
              method to be applied

              \  - {{reference_picture}} do not add to the output
              image_urls without passing a value

              \  - The final output prompt must be in English"
        schema_overrides:
          - schema:
              type: array
      - handle: skills
        value:
          []
      - handle: stream
        value: true
      - handle: main_picture
        from_flow:
          - input_handle: main_picture
      - handle: reference_picture
        value:
        from_flow:
          - input_handle: reference_picture
      - handle: prompt
        from_flow:
          - input_handle: prompt
    task: llm::llm-json
    inputs_def:
      - handle: main_picture
        json_schema:
          type: string
        nullable: false
      - handle: reference_picture
        json_schema:
          type: string
        nullable: true
      - handle: prompt
        json_schema:
          type: string
          ui:widget: text
        nullable: false
        description: Edit instruction prompt describing the desired changes
    outputs_def:
      - handle: image_urls
        json_schema:
          type: array
          items:
            type: string
        nullable: false
        description: List of image URLs to edit
      - handle: prompt
        json_schema:
          type: string
          ui:widget: text
        nullable: false
        description: Edit instruction prompt describing the desired changes
inputs_def:
  - handle: main_picture
    description: "URL of the primary image to be edited. This is the main subject
      image that will undergo AI-powered transformations. Must be a publicly
      accessible URL pointing to a valid image file (JPEG, PNG, etc.). Example:
      'https://example.com/main.jpg'. This image serves as the base for all
      editing operations specified in the prompt."
    json_schema:
      type: string
    executor_name: python
  - handle: reference_picture
    description: "Optional URL of a reference image used to guide the editing style
      or provide additional context. Can be used for style transfer, color
      matching, or as a visual example of desired changes. Must be publicly
      accessible if provided. Leave empty (null) if not needed. Example:
      'https://example.com/reference.jpg'."
    json_schema:
      type: string
    executor_name: python
    nullable: true
    value:
  - handle: prompt
    description: "Natural language instruction describing the desired image
      modifications. The prompt is automatically enhanced and refined by an LLM
      before being sent to the Nano Banana API. Be clear about what changes to
      apply. Examples: 'make the sky more dramatic with sunset colors', 'change
      the person's clothing to formal attire', 'add snow to the landscape'. More
      detailed prompts generally produce better results."
    json_schema:
      type: string
      ui:widget: text
    nullable: false
    executor_name: python
  - group: Optional
    collapsed: true
  - handle: poll_interval
    description: "Time interval in seconds between result polling attempts. Controls
      how frequently the subflow checks if image processing is complete.
      Default: system-defined (typically 2-5 seconds). Lower values provide
      faster response but increase API requests. Recommended range: 1-60
      seconds."
    json_schema:
      type: integer
    value:
    nullable: true
    executor_name: python
  - handle: max_attempts
    description: "Maximum number of polling attempts before timing out. Prevents
      indefinite waiting on stuck jobs. Default: system-defined (typically 30-60
      attempts). Total timeout = poll_interval × max_attempts. Example: 5
      seconds × 30 attempts = 150 seconds maximum wait. Recommended range: 5-120
      attempts."
    json_schema:
      type: integer
    value:
    nullable: true
    executor_name: python
outputs_def:
  - handle: images
    json_schema:
      type: array
      items:
        type: string
    nullable: false
    description: "Array of URLs pointing to the successfully edited images generated
      by the Nano Banana AI model. Each URL provides direct access to a
      processed image file. URLs are typically hosted on cloud storage and
      remain accessible for a limited time. The number of images returned
      depends on the API response. Example:
      ['https://storage.example.com/edited_1.jpg',
      'https://storage.example.com/edited_2.jpg']."
    executor_name: python
outputs_from:
  - handle: images
    from_node:
      - node_id: nano-banana-get-result#1
        output_handle: images
